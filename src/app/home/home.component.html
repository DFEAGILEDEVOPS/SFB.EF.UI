<div class="govuk-breadcrumbs">
  <ol class="govuk-breadcrumbs__list">
    <li class="govuk-breadcrumbs__list-item">
      <a class="govuk-breadcrumbs__link" href="/">Home</a>
    </li>
    <li class="govuk-breadcrumbs__list-item">
      <a class="govuk-breadcrumbs__link" href="/school/detail?urn={{model.urn}}">{{model.name}}</a>
    </li>
    <li class="govuk-breadcrumbs__list-item">
      <a class="govuk-breadcrumbs__link" href="/efficiency-metric/how-it-works">How the efficiency metric works</a></li>
  </ol>
</div>
<h1 class="govuk-heading-xl">Efficiency Metric Ranking</h1>
<p class="govuk-body-s">
  Results for
  <span class="highlight">
    <span class="govuk-!-font-weight-bold">{{model.name}}</span>
  </span>
</p>

<div class="govuk-grid-row govuk-body em-rank-content-wrapper">
  <div class="govuk-grid-column-full">
    <div class="em-table-rank-icon">
      <span class="em-table-rank-icon__text em-table-rank-cell__text--{{model.rank}}">{{model.rank}}</span>
    </div>
    <div class="em-table-rank-content">
      <span class="govuk-!-font-size-24 govuk-!-font-weight-bold">This school's Efficiency Metric Ranking is {{model.rank}}</span>
      <br>
      <span>This means <span class="govuk-!-font-weight-bold">{{(model.rank-1)*0.1  | percent}}</span> of similar schools get better pupil progress for a similar amount of money.</span>
      <br>
      <a [routerLink]="" (click)='openModal(template)' class="govuk-link" >How we calculate the Efficiency Metric Ranking</a>
    </div>
  </div>
</div>

<hr class="govuk-section-break govuk-section-break--xl govuk-section-break--visible">

<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <h3 class="govuk-heading-m">Efficiency Metric Ranking table
      <span *ngIf='this.tableState === "full"' class="govuk-!-font-weight-regular">(Full table)</span>
      <span *ngIf='this.tableState === "decileOnly"' class="govuk-!-font-weight-regular">(Your school's decile)</span>
    </h3>
  </div>

  <div class="govuk-grid-column-one-third govuk-body-s">
    <a [routerLink]="" (click)='onTableDecileToggle()' class="govuk-link toggle-decile-table-link">
      <span *ngIf='this.tableState === "full"'>Show your school's decile</span>
      <span *ngIf='this.tableState === "decileOnly"'>Show full table</span>
    </a>
  </div>
</div>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <a [routerLink]="" (click)='onColumnDetailsToggle()' class="govuk-link">
      <span *ngIf='this.columnState === "contact-details"'>View school data</span>
      <span *ngIf='this.columnState === "school-data"'>View school contact details</span>
    </a>
  </div>
</div>


<table class="govuk-table em-table">
  <thead class="govuk-table__head">
    <tr class="govuk-table__row">
      <th scope="col" class="govuk-table__header">Rank</th>
      <th scope="col" class="govuk-table__header">School</th>
      <th [hidden] = 'this.columnState === "contact-details"' scope="col" class="govuk-table__header">Local authority</th>
      <th [hidden] = 'this.columnState === "contact-details"' scope="col" class="govuk-table__header govuk-table__header--numeric">Pupils</th>
      <th [hidden] = 'this.columnState === "contact-details"' scope="col" class="govuk-table__header govuk-table__header--numeric">Ever6 FSM</th>
      <th [hidden] = 'this.columnState === "contact-details"' scope="col" class="govuk-table__header govuk-table__header--numeric">SEN/EHCP</th>
      <th [hidden] = 'this.columnState === "contact-details"' scope="col" class="govuk-table__header govuk-table__header--numeric">Income per pupil</th>
      <th [hidden] = 'this.columnState === "contact-details"' scope="col" class="govuk-table__header em-table__ks2-header" *ngIf='model.phase === "Primary"'>Reading</th>
      <th [hidden] = 'this.columnState === "contact-details"' scope="col" class="govuk-table__header em-table__ks2-header" *ngIf='model.phase === "Primary"'>Writing</th>
      <th [hidden] = 'this.columnState === "contact-details"' scope="col" class="govuk-table__header em-table__ks2-header" *ngIf='model.phase === "Primary"'>Maths</th>
      <th [hidden] = 'this.columnState === "contact-details"' scope="col" class="govuk-table__header em-table__p8-header" *ngIf='model.phase === "Secondary"'>Progress 8 score</th>
      <th [hidden] = 'this.columnState === "school-data"' scope="col" class="govuk-table__header govuk-table__header--numeric">URN</th>
      <th [hidden] = 'this.columnState === "school-data"' scope="col" class="govuk-table__header">Address</th>
      <th [hidden] = 'this.columnState === "school-data"' scope="col" class="govuk-table__header govuk-table__header--numeric">Telephone</th>
      <th [hidden] = 'this.columnState === "school-data"' scope="col" class="govuk-table__header">Headteacher</th>
    </tr>
  </thead>
  <tbody class="govuk-table__body">
    <tr class="govuk-table__row" *ngFor='let neighbour of model.neighbourDataModels; let i = index' [hidden] = 'this.tableState === "decileOnly" && this.model.rank !== neighbour.rank'>
      <td *ngIf='i % 5 === 0' class="govuk-table__cell em-table-rank-cell em-table-rank-cell--{{neighbour.rank}}" rowspan="5">
        <span class="em-table-rank-cell__text em-table-rank-cell__text--{{neighbour.rank}}">{{neighbour.rank}}</span></td>
      <td class="govuk-table__cell em-table-name-cell"><a [class.table-cell-highlight]='neighbour.urn === model.urn' href="{{appsettings.sfbDomain}}/school/detail?urn={{neighbour.urn}}">{{neighbour.name}}</a></td>
      <td [hidden] = 'this.columnState === "contact-details"' class="govuk-table__cell"><span [class.table-cell-highlight]='neighbour.localAuthority === model.localAuthority'>{{neighbour.localAuthority}}</span></td>
      <td [hidden] = 'this.columnState === "contact-details"' class="govuk-table__cell govuk-table__cell--numeric">{{neighbour.pupils}}</td>
      <td [hidden] = 'this.columnState === "contact-details"' class="govuk-table__cell govuk-table__cell--numeric">{{neighbour.ever6 | percent:'1.1'}} </td>
      <td [hidden] = 'this.columnState === "contact-details"' class="govuk-table__cell govuk-table__cell--numeric">{{neighbour.sen | percent:'1.1'}}</td>
      <td [hidden] = 'this.columnState === "contact-details"' class="govuk-table__cell govuk-table__cell--numeric">{{neighbour.incomePP | currency :'GBP':'symbol':'0.0-0'}}</td>
      <td [hidden] = 'this.columnState === "contact-details"' class="govuk-table__cell em-table-ks2-reading-cell" *ngIf='model.phase === "Primary"'>
        <span class="em-table-ks2-reading-cell__text"
        [ngClass]="{
          'em-table-ks2-reading-cell__text--well-below': neighbour.progressReading <= -5 ,
          'em-table-ks2-reading-cell__text--below': neighbour.progressReading > -5 && neighbour.progressReading < -0.25,
          'em-table-ks2-reading-cell__text--average': neighbour.progressReading >= -0.25 && neighbour.progressReading <= 0.25,
          'em-table-ks2-reading-cell__text--above': neighbour.progressReading < 5 && neighbour.progressReading > 0.25,
          'em-table-ks2-reading-cell__text--well-above': neighbour.progressReading >= 5}">
          {{neighbour.progressReading | number: '1.2-2' }}
        </span>
      </td>
      <td [hidden] = 'this.columnState === "contact-details"' class="govuk-table__cell em-table-ks2-writing-cell" *ngIf='model.phase === "Primary"'>
        <span class="em-table-ks2-writing-cell__text"
        [ngClass]="{
          'em-table-ks2-reading-cell__text--well-below': neighbour.progressWriting <= -5 ,
          'em-table-ks2-reading-cell__text--below': neighbour.progressWriting > -5 && neighbour.progressWriting < -0.25,
          'em-table-ks2-reading-cell__text--average': neighbour.progressWriting >= -0.25 && neighbour.progressWriting <= 0.25,
          'em-table-ks2-reading-cell__text--above': neighbour.progressWriting < 5 && neighbour.progressWriting > 0.25,
          'em-table-ks2-reading-cell__text--well-above': neighbour.progressWriting >= 5}">
          {{neighbour.progressWriting | number: '1.2-2'}}
        </span>
      </td>
      <td [hidden] = 'this.columnState === "contact-details"' class="govuk-table__cell em-table-ks2-maths-cell" *ngIf='model.phase === "Primary"'>
        <span class="em-table-ks2-maths-cell__text"
        [ngClass]="{
          'em-table-ks2-reading-cell__text--well-below': neighbour.progressMaths <= -5 ,
          'em-table-ks2-reading-cell__text--below': neighbour.progressMaths > -5 && neighbour.progressMaths < -0.25,
          'em-table-ks2-reading-cell__text--average': neighbour.progressMaths >= -0.25 && neighbour.progressMaths <= 0.25,
          'em-table-ks2-reading-cell__text--above': neighbour.progressMaths < 5 && neighbour.progressMaths > 0.25,
          'em-table-ks2-reading-cell__text--well-above': neighbour.progressMaths >= 5}">
          {{neighbour.progressMaths | number: '1.2-2'}}
        </span>
      </td>
      <td [hidden] = 'this.columnState === "contact-details"' class="govuk-table__cell em-table-p8-cell" *ngIf='model.phase === "Secondary"'>
        <span class="em-table-p8-cell__text"
        [ngClass]="{
        'em-table-p8-cell__text--well-below': neighbour.progress8 <= -5 ,
        'em-table-p8-cell__text--below': neighbour.progress8 > -5 && neighbour.progress8 < -0.25,
        'em-table-p8-cell__text--average': neighbour.progress8 >= -0.25 && neighbour.progress8 <= 0.25,
        'em-table-p8-cell__text--above': neighbour.progress8 < 5 && neighbour.progress8 > 0.25,
        'em-table-p8-cell__text--well-above': neighbour.progress8 >= 5}">
          {{neighbour.progress8 | number: '1.2-2'}}
        </span>
      </td>
      <td [hidden] = 'this.columnState === "school-data"' class="govuk-table__cell govuk-table__cell--numeric">{{neighbour.urn}}</td>
      <td [hidden] = 'this.columnState === "school-data"' class="govuk-table__cell">{{neighbour.address}}</td>
      <td [hidden] = 'this.columnState === "school-data"' class="govuk-table__cell govuk-table__cell--numeric">{{neighbour.telephone}}</td>
      <td [hidden] = 'this.columnState === "school-data"' class="govuk-table__cell">{{neighbour.headTeacher}}</td>
    </tr>
  </tbody>
</table>


<ng-template #template>
  <div class="modal-header">
    <h4 class="modal-title pull-left">Methodology</h4>
    <button type="button" class="close pull-right" aria-label="Close" (click)="modalRef.hide()">
      <span aria-hidden="true">Close</span>
    </button>
  </div>
  <div class="modal-body">
    <p>The efficiency metric algorithm looks for 50 schools across the country which are similar to your school based on:</p>
    <ul class="govuk-list govuk-list--bullet govuk-body-s govuk-!-font-weight-bold ul-two-cols">
      <li>Pupils eligible for FSM in the last 6 years</li>
      <li>Number of pupils</li>
      <li>Pupils with a SEN statement or EHCP</li>
      <li>School phase</li>
      <li>School type</li>
    </ul>
    <p>We divide these school's progress score by their expenditure per pupil (we will standardise the score) allowing us to rank the 50 schools.</p>
    <p class="govuk-!-font-weight-bold">
      Standardised progress score / Expenditure per pupil = Efficiency Metric Ranking
    </p>
  </div>
</ng-template>


